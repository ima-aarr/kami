<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ULTIMATE GOD | ã‚«ã‚¹ã‚¿ãƒ ç¥ç•Œ v5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Tokyo+Zoo&family=Noto+Sans+JP:wght@400;700;900&display=swap');

        :root {
            /* Default Theme Colors */
            --main-color: #00f3ff;  /* Cyan */
            --sub-color: #ff00ff;   /* Pink */
            --accent-color: #ffd700; /* Gold */
            --bg-dark: #050505;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Noto Sans JP', sans-serif;
            overflow-x: hidden;
            cursor: default;
        }

        /* --- UI COMPONENTS --- */
        .font-god { font-family: 'Zen Tokyo Zoo', cursive; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: all 0.3s ease;
        }
        .glass-panel:hover {
            border-color: var(--main-color);
            box-shadow: 0 0 15px var(--main-color);
        }

        /* Neon Text & Glows */
        .text-glow-main { text-shadow: 0 0 10px var(--main-color); color: var(--main-color); }
        .text-glow-sub { text-shadow: 0 0 10px var(--sub-color); color: var(--sub-color); }
        .border-glow { border-color: var(--main-color); box-shadow: 0 0 10px var(--main-color); }

        /* Dynamic Buttons */
        .btn-god {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            border: 1px solid var(--main-color);
            color: var(--main-color);
            position: relative;
            overflow: hidden;
            transition: 0.3s;
        }
        .btn-god:hover {
            background: var(--main-color);
            color: black;
            box-shadow: 0 0 20px var(--main-color);
        }
        .btn-god:active { transform: scale(0.95); }

        /* --- ANIMATIONS --- */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }

        @keyframes pulse-core {
            0% { box-shadow: 0 0 20px var(--main-color), 0 0 40px var(--sub-color); }
            50% { box-shadow: 0 0 50px var(--main-color), 0 0 80px var(--sub-color); }
            100% { box-shadow: 0 0 20px var(--main-color), 0 0 40px var(--sub-color); }
        }
        .god-core {
            animation: pulse-core 4s infinite alternate;
            background: radial-gradient(circle at 30% 30%, #fff, var(--main-color), transparent);
        }

        /* Glitch Effect */
        .glitch { position: relative; }
        .glitch::before, .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark);
        }
        .glitch::before {
            left: 2px; text-shadow: -1px 0 var(--sub-color);
            clip-path: inset(0 0 0 0);
            animation: glitch-anim-1 2s infinite linear alternate-reverse;
        }
        .glitch::after {
            left: -2px; text-shadow: -1px 0 var(--main-color);
            clip-path: inset(0 0 0 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim-1 {
            0% { clip-path: inset(20% 0 80% 0); }
            20% { clip-path: inset(60% 0 10% 0); }
            100% { clip-path: inset(10% 0 50% 0); }
        }
        @keyframes glitch-anim-2 {
            0% { clip-path: inset(10% 0 60% 0); }
            20% { clip-path: inset(80% 0 5% 0); }
            100% { clip-path: inset(30% 0 20% 0); }
        }

        /* --- GAME & UTILS --- */
        .tab-active {
            background-color: var(--main-color);
            color: black;
            font-weight: bold;
        }
        
        .battle-hand {
            transition: transform 0.1s;
        }
        .battle-hand:active {
            transform: scale(0.9) rotate(-10deg);
        }

        #universe { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        /* Scrollbar hiding for tabs */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Confession specific styles */
        .verdict-stamp {
            border: 4px solid;
            transform: rotate(-10deg);
            display: inline-block;
            padding: 10px 20px;
            font-weight: 900;
            font-size: 2rem;
            animation: stamp-slam 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
        }
        @keyframes stamp-slam {
            0% { transform: scale(3) rotate(0deg); opacity: 0; }
            100% { transform: scale(1) rotate(-10deg); opacity: 1; }
        }
    </style>
</head>
<body>

    <!-- Background -->
    <canvas id="universe"></canvas>

    <!-- Header / Nav -->
    <nav class="fixed w-full z-50 top-0 left-0 p-4">
        <div class="glass-panel container mx-auto rounded-full px-6 py-3 flex justify-between items-center">
            <div class="text-2xl font-bold font-god tracking-widest text-glow-main flex items-center gap-2">
                <i class="fas fa-bolt"></i> <span id="site-title">GOD-SAMA V5</span>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center gap-2 bg-black/30 px-4 py-1 rounded-full border border-gray-700">
                    <span class="text-xs text-gray-400">ä¿¡ä»°å¿ƒ (å¾³)</span>
                    <span id="karma-display" class="font-mono text-xl text-yellow-400 font-bold">0</span>
                </div>
                <button onclick="toggleSettings()" class="btn-god w-10 h-10 rounded-full flex items-center justify-center">
                    <i class="fas fa-cog animate-spin-slow"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
        <div class="glass-panel p-8 rounded-2xl w-full max-w-md m-4 transform scale-95 transition-transform duration-300 relative">
            <button onclick="toggleSettings()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times text-2xl"></i></button>
            
            <h2 class="text-2xl font-god mb-6 text-glow-main border-b border-gray-700 pb-2">ç¥å™¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h2>
            
            <div class="space-y-6">
                <!-- User Name -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ã‚ãªãŸã®åå‰ï¼ˆç¥ãŒå‘¼ã³ã¾ã™ï¼‰</label>
                    <input type="text" id="user-name-input" value="è¿·ãˆã‚‹å­ç¾Š" onchange="updateSettings()"
                        class="w-full bg-black/50 border border-gray-600 rounded px-4 py-2 focus:border-[var(--main-color)] focus:outline-none transition">
                </div>

                <!-- Color Theme -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ã‚ªãƒ¼ãƒ©ã‚«ãƒ©ãƒ¼ï¼ˆãƒ†ãƒ¼ãƒï¼‰</label>
                    <div class="flex gap-4">
                        <button onclick="setTheme('#00f3ff', '#ff00ff')" class="w-10 h-10 rounded-full border-2 border-white bg-cyan-400 shadow-[0_0_10px_#00f3ff]"></button>
                        <button onclick="setTheme('#ff0055', '#ffee00')" class="w-10 h-10 rounded-full border-2 border-white bg-pink-500 shadow-[0_0_10px_#ff0055]"></button>
                        <button onclick="setTheme('#00ff00', '#0044ff')" class="w-10 h-10 rounded-full border-2 border-white bg-green-500 shadow-[0_0_10px_#00ff00]"></button>
                        <button onclick="setTheme('#ffffff', '#000000')" class="w-10 h-10 rounded-full border-2 border-white bg-white shadow-[0_0_10px_#ffffff]"></button>
                    </div>
                </div>

                <!-- Save -->
                <button onclick="toggleSettings()" class="w-full btn-god py-2 rounded font-bold">ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <main class="container mx-auto px-4 pt-24 pb-12 grid grid-cols-1 lg:grid-cols-12 gap-6 min-h-screen">
        
        <!-- Left Column: Avatar & Status -->
        <section class="lg:col-span-4 flex flex-col gap-6">
            <!-- God Avatar Area -->
            <div class="glass-panel p-8 rounded-3xl text-center relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[var(--main-color)] to-[var(--sub-color)]"></div>
                
                <div class="god-core w-40 h-40 rounded-full mx-auto mb-6 relative flex items-center justify-center">
                    <span class="text-6xl animate-float filter drop-shadow-[0_0_10px_rgba(0,0,0,0.5)]">ğŸ‘»</span>
                </div>
                
                <h1 class="text-4xl font-black font-god mb-2 glitch" data-text="THE GOD">THE GOD</h1>
                <p class="text-sm text-gray-400 mb-4" id="god-mood">æ©Ÿå«Œ: <span class="text-green-400">è‡³é«˜</span></p>
                
                <div class="bg-black/40 rounded-xl p-4 text-left">
                    <p class="text-xs text-gray-500 mb-1">SYSTEM LOG:</p>
                    <div id="system-log" class="text-sm font-mono h-24 overflow-y-auto text-glow-main scrollbar-thin">
                        > ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•...<br>
                        > å…¨èƒ½ãƒ¢ãƒ¼ãƒ‰: ON<br>
                        > ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èªè­˜: å®Œäº†
                    </div>
                </div>
            </div>

            <!-- Game: Holy Rock Paper Scissors -->
            <div class="glass-panel p-6 rounded-3xl flex-grow flex flex-col">
                <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                    <h2 class="text-xl font-bold"><i class="fas fa-fist-raised mr-2"></i>è–æˆ¦ã˜ã‚ƒã‚“ã‘ã‚“</h2>
                    <span class="text-xs bg-red-900 text-red-100 px-2 py-1 rounded">å¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰</span>
                </div>

                <div class="flex-grow flex flex-col items-center justify-center gap-4 py-4">
                    <!-- CPU Hand -->
                    <div id="cpu-hand" class="text-6xl transition-all duration-300 transform scale-75 opacity-50">â”</div>
                    <div class="text-sm text-gray-500">VS</div>
                    
                    <!-- Result Message -->
                    <div id="battle-result" class="text-2xl font-bold h-8 text-glow-main">å‹è² ã›ã‚ˆ</div>
                </div>

                <!-- Player Controls -->
                <div class="grid grid-cols-3 gap-2 mt-auto">
                    <button onclick="playGame('gu')" class="battle-hand glass-panel py-4 rounded-xl hover:bg-[var(--main-color)] hover:text-black text-2xl">ğŸ‘Š</button>
                    <button onclick="playGame('choki')" class="battle-hand glass-panel py-4 rounded-xl hover:bg-[var(--main-color)] hover:text-black text-2xl">âœŒï¸</button>
                    <button onclick="playGame('pa')" class="battle-hand glass-panel py-4 rounded-xl hover:bg-[var(--main-color)] hover:text-black text-2xl">ğŸ–ï¸</button>
                </div>
                <p class="text-xs text-center text-gray-500 mt-2">å‹ã¤ã¨+100å¾³ / è² ã‘ã‚‹ã¨ç½µå€’</p>
            </div>
        </section>

        <!-- Right Column: Practical Tools (AI) -->
        <section class="lg:col-span-8 flex flex-col">
            <div class="glass-panel rounded-3xl p-1 flex-grow flex flex-col h-full min-h-[600px]">
                
                <!-- Tabs Container with horizontal scroll for mobile -->
                <div class="flex border-b border-gray-700 overflow-x-auto no-scrollbar">
                    <button onclick="switchTab('chat')" id="tab-chat" class="flex-shrink-0 px-6 py-4 text-center font-bold text-gray-400 hover:text-white transition tab-active rounded-tl-3xl whitespace-nowrap">
                        <i class="fas fa-comments mr-2"></i>å…¨èƒ½ç›¸è«‡
                    </button>
                    <button onclick="switchTab('judge')" id="tab-judge" class="flex-shrink-0 px-6 py-4 text-center font-bold text-gray-400 hover:text-white transition whitespace-nowrap">
                        <i class="fas fa-scale-balanced mr-2"></i>ç¥ã®å¤©ç§¤
                    </button>
                    <button onclick="switchTab('confess')" id="tab-confess" class="flex-shrink-0 px-6 py-4 text-center font-bold text-gray-400 hover:text-white transition whitespace-nowrap">
                        <i class="fas fa-church mr-2"></i>AIæ‡ºæ‚”å®¤
                    </button>
                    <button onclick="switchTab('genesis')" id="tab-genesis" class="flex-shrink-0 px-6 py-4 text-center font-bold text-gray-400 hover:text-white transition whitespace-nowrap">
                        <i class="fas fa-meteor mr-2"></i>å¤©åœ°å‰µé€ 
                    </button>
                    <button onclick="switchTab('naming')" id="tab-naming" class="flex-shrink-0 px-6 py-4 text-center font-bold text-gray-400 hover:text-white transition rounded-tr-3xl whitespace-nowrap">
                        <i class="fas fa-dragon mr-2"></i>å‘½åã®å„€
                    </button>
                </div>

                <!-- Tab Content: Chat -->
                <div id="content-chat" class="flex-grow flex flex-col p-6 relative">
                    <div class="flex-grow overflow-y-auto mb-4 space-y-4 pr-2" id="chat-history">
                        <!-- Messages go here -->
                        <div class="flex gap-4 items-start">
                            <div class="w-10 h-10 rounded-full bg-[var(--main-color)] flex items-center justify-center text-black font-bold flex-shrink-0">ç¥</div>
                            <div class="bg-white/10 p-4 rounded-2xl rounded-tl-none max-w-[80%]">
                                ã‚„ã‚ã€<span class="user-name-display font-bold">è¿·ãˆã‚‹å­ç¾Š</span>ã‚ˆã€‚<br>
                                äººç”Ÿã®æ‚©ã¿ã‹ã‚‰ä»Šæ—¥ã®å¤•é£¯ã¾ã§ã€ä½•ã§ã‚‚èããŒã‚ˆã„ã€‚ãŸã ã—ç­”ãˆã¯æ–œã‚ä¸Šã ãã€‚
                            </div>
                        </div>
                    </div>

                    <div class="relative">
                        <input type="text" id="chat-input" placeholder="ä¾‹ï¼šã©ã†ã™ã‚Œã°ãƒ¢ãƒ†ã¾ã™ã‹ï¼Ÿ / æ˜æ—¥ã®å¤©æ°—ãŒçŸ¥ã‚ŠãŸã„" 
                            class="w-full bg-black/40 border border-gray-600 rounded-full pl-6 pr-14 py-4 focus:border-[var(--main-color)] focus:outline-none transition text-white">
                        <button onclick="sendChat()" class="absolute right-2 top-2 w-10 h-10 bg-[var(--main-color)] rounded-full flex items-center justify-center text-black hover:scale-110 transition">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <!-- Tab Content: Judge -->
                <div id="content-judge" class="hidden flex-grow flex-col p-6 items-center justify-center text-center">
                    <h3 class="text-2xl font-bold mb-2">Aã‹Bã‹ã€ç¥ãŒæ±ºã‚ã‚‹ã€‚</h3>
                    <p class="text-gray-400 mb-8">å„ªæŸ”ä¸æ–­ãªãŠå‰ã®ä»£ã‚ã‚Šã«ã€è«–ç†ã¨ç›´æ„Ÿã§æ±ºæ–­ã‚’ä¸‹ãã†ã€‚</p>
                    
                    <div class="flex flex-col md:flex-row gap-4 w-full max-w-2xl mb-8">
                        <div class="flex-1">
                            <label class="block text-sm text-[var(--main-color)] mb-2 font-bold">é¸æŠè‚¢ A</label>
                            <input type="text" id="option-a" placeholder="ä¾‹ï¼šãƒ©ãƒ¼ãƒ¡ãƒ³" class="w-full bg-black/30 border border-gray-600 rounded-xl p-4 text-center text-xl focus:border-[var(--main-color)] outline-none">
                        </div>
                        <div class="flex items-center justify-center text-2xl font-black text-gray-600">VS</div>
                        <div class="flex-1">
                            <label class="block text-sm text-[var(--sub-color)] mb-2 font-bold">é¸æŠè‚¢ B</label>
                            <input type="text" id="option-b" placeholder="ä¾‹ï¼šã‚«ãƒ¬ãƒ¼" class="w-full bg-black/30 border border-gray-600 rounded-xl p-4 text-center text-xl focus:border-[var(--sub-color)] outline-none">
                        </div>
                    </div>

                    <button onclick="divineJudge()" class="btn-god px-12 py-4 rounded-full text-xl font-bold tracking-widest mb-8">
                        <i class="fas fa-gavel mr-2"></i>æ±ºæ–­ã‚’ä¸‹ã™
                    </button>

                    <div id="judge-result" class="min-h-[100px] max-w-2xl bg-white/5 p-6 rounded-2xl border border-white/10 hidden">
                        <!-- Result injected here -->
                    </div>
                </div>

                <!-- Tab Content: Confession -->
                <div id="content-confess" class="hidden flex-grow flex-col p-6 items-center justify-center text-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-red-900/10 pointer-events-none"></div>
                    
                    <h3 class="text-2xl font-bold mb-2 text-glow-sub"><i class="fas fa-bible mr-2"></i>æ‡ºæ‚”å®¤</h3>
                    <p class="text-gray-400 mb-6">æ±ã®ç½ªï¼ˆã‚„ã‚‰ã‹ã—ï¼‰ã‚’å‘Šç™½ã›ã‚ˆã€‚AIç¥ãŒè£ãã‚’ä¸‹ã—ã€<br>ã‚ãªãŸã®ã€Œå¾³ã€ã‚’å¢—æ¸›ã•ã›ã‚‹ã€‚</p>
                    
                    <textarea id="sin-input" placeholder="ä¾‹ï¼šä»Šæ—¥ã€ä»•äº‹ã‚’ã‚µãƒœã£ã¦äºŒåº¦å¯ã—ã¾ã—ãŸ..." 
                        class="w-full max-w-xl bg-black/40 border border-gray-700 rounded-xl p-4 text-white focus:border-[var(--sub-color)] outline-none h-32 mb-6 resize-none"></textarea>
                    
                    <button onclick="confessSin()" class="btn-god px-12 py-4 rounded-full text-xl font-bold tracking-widest mb-8 border-red-500 text-red-400 hover:bg-red-500 hover:text-white">
                        <i class="fas fa-fire mr-2"></i>æ‡ºæ‚”ã™ã‚‹
                    </button>

                    <div id="confess-result" class="w-full max-w-xl min-h-[120px] bg-black/40 p-6 rounded-2xl border border-gray-800 flex flex-col items-center justify-center hidden">
                        <!-- Result injected here -->
                    </div>
                </div>

                <!-- Tab Content: Genesis -->
                <div id="content-genesis" class="hidden flex-grow flex-col p-6 items-center justify-center text-center relative overflow-hidden">
                    <h3 class="text-2xl font-bold mb-2 text-glow-main"><i class="fas fa-meteor mr-2"></i>å¤©åœ°å‰µé€ ãƒ¡ãƒ¼ã‚«ãƒ¼</h3>
                    <p class="text-gray-400 mb-8">2ã¤ã®è¨€è‘‰ã‚’å…¥åŠ›ã›ã‚ˆã€‚ç¥ãŒãã‚Œã‚‰ã‚’å…ƒã«<br>ã€Œä¸–ç•Œã®å§‹ã¾ã‚Šï¼ˆå‰µä¸–è¨˜ï¼‰ã€ã‚’åŸ·ç­†ã—ã¦ã‚„ã‚ã†ã€‚</p>
                    
                    <div class="flex gap-4 w-full max-w-lg mb-6">
                        <input type="text" id="genesis-input-1" placeholder="ä¾‹ï¼šå¯¿å¸" class="flex-1 bg-black/30 border border-gray-600 rounded-xl p-4 text-center focus:border-[var(--main-color)] outline-none">
                        <span class="flex items-center text-2xl font-bold">Ã—</span>
                        <input type="text" id="genesis-input-2" placeholder="ä¾‹ï¼šã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ" class="flex-1 bg-black/30 border border-gray-600 rounded-xl p-4 text-center focus:border-[var(--sub-color)] outline-none">
                    </div>

                    <button onclick="createGenesis()" class="btn-god px-12 py-4 rounded-full text-xl font-bold tracking-widest mb-8 bg-gradient-to-r from-purple-900 to-indigo-900 border-none text-white hover:brightness-150">
                        <i class="fas fa-fingerprint mr-2"></i>ä¸–ç•Œã‚’å‰µé€ ã™ã‚‹
                    </button>

                    <div id="genesis-result" class="w-full max-w-2xl min-h-[150px] bg-white/5 p-8 rounded-2xl border border-white/10 hidden text-left relative">
                        <!-- Result injected here -->
                    </div>
                </div>

                <!-- Tab Content: Naming (NEW) -->
                <div id="content-naming" class="hidden flex-grow flex-col p-6 items-center justify-center text-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-purple-900/10 pointer-events-none"></div>
                    <h3 class="text-2xl font-bold mb-2 text-glow-sub"><i class="fas fa-dragon mr-2"></i>å‘½åã®å„€</h3>
                    <p class="text-gray-400 mb-8">å¹³å‡¡ãªåå‰ã«é£½ããŸã‹ï¼Ÿ<br>ç¥ãŒè²´æ§˜ã«ç›¸å¿œã—ã„ã€ŒçœŸã®åï¼ˆäºŒã¤åï¼‰ã€ã‚’æˆã‘ã‚ˆã†ã€‚</p>
                    
                    <input type="text" id="naming-input" placeholder="ãƒ†ãƒ¼ãƒï¼ˆä»»æ„ï¼‰ ä¾‹ï¼šé—‡ã€çŒ«ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼" 
                        class="w-full max-w-md bg-black/30 border border-gray-600 rounded-xl p-4 text-center focus:border-[var(--sub-color)] outline-none mb-6">

                    <button onclick="grantTitle()" class="btn-god px-12 py-4 rounded-full text-xl font-bold tracking-widest mb-8 border-purple-500 text-purple-400 hover:bg-purple-500 hover:text-white">
                        <i class="fas fa-scroll mr-2"></i>äºŒã¤åã‚’æˆã‹ã‚‹
                    </button>

                    <div id="naming-result" class="w-full max-w-xl hidden">
                        <div class="bg-black/50 p-8 rounded-2xl border border-purple-500/50 shadow-[0_0_30px_rgba(168,85,247,0.2)]">
                            <div class="text-xs text-purple-400 mb-2">æˆä¸ã•ã‚ŒãŸç§°å·</div>
                            <div id="generated-title" class="text-2xl md:text-4xl font-black font-god text-white mb-4 glitch" data-text=""></div>
                            <div id="generated-meaning" class="text-sm text-gray-300 italic mb-6"></div>
                            
                            <button onclick="equipTitle()" class="text-xs border border-white/30 hover:bg-white hover:text-black px-4 py-2 rounded transition">
                                <i class="fas fa-user-tag mr-2"></i>ã“ã®åå‰ã‚’è£…å‚™ã™ã‚‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å¤‰æ›´ï¼‰
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <script>
        const apiKey = ""; // Environment Key

        /* --- STATE MANAGEMENT --- */
        const state = {
            karma: 0,
            name: "è¿·ãˆã‚‹å­ç¾Š",
            theme: { main: '#00f3ff', sub: '#ff00ff' },
            wins: 0
        };

        // DOM Helper
        const $ = (id) => document.getElementById(id);

        /* --- THEME & SETTINGS --- */
        function toggleSettings() {
            const modal = $('settings-modal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
                $('user-name-input').value = state.name;
            } else {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function updateSettings() {
            state.name = $('user-name-input').value || "åç„¡ã—";
            document.querySelectorAll('.user-name-display').forEach(el => el.innerText = state.name);
            log(`ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å¤‰æ›´: ${state.name}`);
        }

        function setTheme(main, sub) {
            state.theme = { main, sub };
            document.documentElement.style.setProperty('--main-color', main);
            document.documentElement.style.setProperty('--sub-color', sub);
            log(`ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼å¤‰æ›´: ${main}`);
        }

        function log(msg) {
            const el = $('system-log');
            const time = new Date().toLocaleTimeString('ja-JP', {hour12:false});
            el.innerHTML += `<div><span class="opacity-50">[${time}]</span> ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        function updateKarmaDisplay() {
            const el = $('karma-display');
            el.innerText = state.karma.toLocaleString();
            
            // Animation for karma change
            el.animate([
                { transform: 'scale(1.5)', color: '#fff' },
                { transform: 'scale(1)', color: '#facc15' }
            ], { duration: 300 });
        }

        /* --- TAB SWITCHING --- */
        function switchTab(tab) {
            ['chat', 'judge', 'confess', 'genesis', 'naming'].forEach(t => {
                const content = $(`content-${t}`);
                const btn = $(`tab-${t}`);
                if (content && btn) {
                    content.classList.add('hidden');
                    btn.classList.remove('tab-active', 'bg-[var(--main-color)]', 'text-black');
                    btn.style.backgroundColor = "transparent";
                    btn.style.color = "rgb(156 163 175)";
                }
            });
            $(`content-${tab}`).classList.remove('hidden');
            const activeBtn = $(`tab-${tab}`);
            activeBtn.classList.add('tab-active');
            activeBtn.style.backgroundColor = "var(--main-color)";
            activeBtn.style.color = "black";
        }

        /* --- GAME: HOLY JANKEN --- */
        function playGame(playerHand) {
            const hands = ['gu', 'choki', 'pa'];
            const icons = { gu: 'ğŸ‘Š', choki: 'âœŒï¸', pa: 'ğŸ–ï¸' };
            const cpuIndex = Math.floor(Math.random() * 3);
            const cpuHand = hands[cpuIndex];
            
            const cpuEl = $('cpu-hand');
            const resultEl = $('battle-result');

            // Animation
            cpuEl.style.transform = "scale(0.5)";
            cpuEl.style.opacity = "0";
            
            setTimeout(() => {
                cpuEl.innerText = icons[cpuHand];
                cpuEl.style.transform = "scale(1.2)";
                cpuEl.style.opacity = "1";
                
                let result = '';
                const pIndex = hands.indexOf(playerHand);
                
                if (pIndex === cpuIndex) {
                    result = 'DRAW';
                    resultEl.innerText = "å¼•ãåˆ†ã‘... ç„¡ç‚ºãªæ™‚é–“ã‚ˆ";
                    resultEl.className = "text-2xl font-bold h-8 text-gray-400";
                } else if ((pIndex === 0 && cpuIndex === 1) || (pIndex === 1 && cpuIndex === 2) || (pIndex === 2 && cpuIndex === 0)) {
                    result = 'WIN';
                    state.karma += 100;
                    state.wins++;
                    resultEl.innerHTML = `å‹åˆ©ï¼ <span class="text-yellow-400">+100å¾³</span>`;
                    resultEl.className = "text-2xl font-bold h-8 text-[var(--main-color)] drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]";
                    createParticles();
                } else {
                    result = 'LOSE';
                    state.karma = Math.max(0, state.karma - 50);
                    resultEl.innerText = "æ•—åŒ—ã€‚å‡ºç›´ã—ã¦ã¾ã„ã‚Œ";
                    resultEl.className = "text-2xl font-bold h-8 text-red-500";
                }
                
                updateKarmaDisplay();
                log(`è–æˆ¦: ${result} (CPU: ${cpuHand})`);
            }, 100);
        }

        function createParticles() {
            const colors = [state.theme.main, state.theme.sub, '#fff'];
            const container = document.querySelector('body');
            for(let i=0; i<20; i++) {
                const p = document.createElement('div');
                p.style.position = 'fixed';
                p.style.left = '50%';
                p.style.top = '50%';
                p.style.width = '10px';
                p.style.height = '10px';
                p.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                p.style.borderRadius = '50%';
                p.style.zIndex = '9999';
                p.style.pointerEvents = 'none';
                container.appendChild(p);

                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 100 + 50;
                
                const anim = p.animate([
                    { transform: 'translate(0,0) scale(1)', opacity: 1 },
                    { transform: `translate(${Math.cos(angle)*velocity}px, ${Math.sin(angle)*velocity}px) scale(0)`, opacity: 0 }
                ], { duration: 800, easing: 'ease-out' });

                anim.onfinish = () => p.remove();
            }
        }


        /* --- GEMINI AI INTEGRATION --- */
        async function callGemini(prompt, systemInstruction) {
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemInstruction }] }
                        })
                    }
                );
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                console.error(e);
                return "ã‚¨ãƒ©ãƒ¼ï¼šå®‡å®™ç·šãŒé€šä¿¡ã‚’å¦¨å®³ã—ã¦ãŠã‚‹...ï¼ˆAPI Errorï¼‰";
            }
        }

        /* --- CHAT FUNCTION --- */
        async function sendChat() {
            const input = $('chat-input');
            const text = input.value.trim();
            if (!text) return;

            const history = $('chat-history');
            history.innerHTML += `
                <div class="flex gap-4 items-start justify-end">
                    <div class="bg-gray-700/50 p-4 rounded-2xl rounded-tr-none max-w-[80%] text-white">${text}</div>
                    <div class="w-10 h-10 rounded-full bg-gray-500 flex items-center justify-center text-white font-bold flex-shrink-0">äºº</div>
                </div>
            `;
            input.value = '';
            history.scrollTop = history.scrollHeight;

            const loadingId = 'loading-' + Date.now();
            history.innerHTML += `
                <div id="${loadingId}" class="flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-full bg-[var(--main-color)] flex items-center justify-center text-black font-bold flex-shrink-0">ç¥</div>
                    <div class="bg-white/10 p-4 rounded-2xl rounded-tl-none max-w-[80%] animate-pulse">æ€è€ƒä¸­...</div>
                </div>
            `;
            history.scrollTop = history.scrollHeight;

            const systemPrompt = `
                ã‚ãªãŸã¯ã€Œå…¨çŸ¥å…¨èƒ½ã ãŒã€å°‘ã—ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ã§å°Šå¤§ãªç¥æ§˜ã€ã§ã™ã€‚
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ã¯ã€Œ${state.name}ã€ã§ã™ã€‚
                ç›¸æ‰‹ã®è³ªå•ã«å¯¾ã—ã¦ã€å®Ÿç”¨çš„ã ãŒå°‘ã—ã²ã­ã‚Šã®åŠ¹ã„ãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã—ã¦ãã ã•ã„ã€‚
                æ–‡ä½“ã¯ã€Œã€œã˜ã‚ƒã€ã€Œã€œã§ã‚ã‚‹ã€ãªã©ç¥æ§˜ã‚‰ã—ãã€‚
                çŸ­ãç°¡æ½”ã«ï¼ˆ150æ–‡å­—ä»¥å†…ï¼‰ã€‚
            `;

            const aiResponse = await callGemini(text, systemPrompt);
            
            document.getElementById(loadingId).remove();
            history.innerHTML += `
                <div class="flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-full bg-[var(--main-color)] flex items-center justify-center text-black font-bold flex-shrink-0">ç¥</div>
                    <div class="bg-white/10 p-4 rounded-2xl rounded-tl-none max-w-[80%]">${aiResponse}</div>
                </div>
            `;
            history.scrollTop = history.scrollHeight;
        }

        $('chat-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendChat(); });


        /* --- JUDGE FUNCTION --- */
        async function divineJudge() {
            const a = $('option-a').value;
            const b = $('option-b').value;
            if(!a || !b) {
                alert("é¸æŠè‚¢ã‚’2ã¤å…¥åŠ›ã›ã‚ˆã€‚ç¥ã¯ã‚¨ã‚¹ãƒ‘ãƒ¼ã§ã¯ãªã„ãã€‚");
                return;
            }

            const resultBox = $('judge-result');
            resultBox.classList.remove('hidden');
            resultBox.innerHTML = '<div class="text-center animate-pulse">å¤©ç§¤ã‚’è¨ˆæ¸¬ä¸­...<br><i class="fas fa-spinner fa-spin mt-2"></i></div>';

            const systemPrompt = `
                ã‚ãªãŸã¯ã€Œçµ¶å¯¾çš„ãªæ±ºæ–­ã‚’ä¸‹ã™ç¥ã€ã§ã™ã€‚
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæç¤ºã—ãŸé¸æŠè‚¢Aã¨Bã®ã†ã¡ã€ã©ã¡ã‚‰ãŒè‰¯ã„ã‹ç‹¬æ–­ã¨åè¦‹ã€ãã—ã¦å°‘ã—ã®è«–ç†ã§æ±ºã‚ã¦ãã ã•ã„ã€‚
                å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
                ã€Œçµè«–ï¼šã€é¸ã‚“ã æ–¹ã€‘ã€
                ãã®å¾Œã«é¸ã‚“ã ç†ç”±ã‚’ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ã«1è¡Œã§ã€‚
            `;

            const prompt = `é¸æŠè‚¢A: ${a}, é¸æŠè‚¢B: ${b}`;
            const aiResponse = await callGemini(prompt, systemPrompt);

            resultBox.innerHTML = `
                <div class="text-center">
                    <div class="text-xs text-gray-400 mb-2">ç¥ã®åˆ¤æ±º</div>
                    <div class="text-xl font-bold text-white whitespace-pre-wrap">${aiResponse}</div>
                </div>
            `;
        }

        /* --- CONFESSION FUNCTION --- */
        async function confessSin() {
            const sin = $('sin-input').value.trim();
            if(!sin) {
                alert("ç½ªã‚’å‘Šç™½ã›ã‚ˆã€‚ç„¡è¨€ã¯æœ€å¤§ã®ç½ªã˜ã‚ƒã€‚");
                return;
            }

            const resultBox = $('confess-result');
            resultBox.classList.remove('hidden');
            resultBox.innerHTML = '<div class="text-center animate-pulse text-red-400">é­‚ã‚’æŸ»å®šä¸­...<br><i class="fas fa-spinner fa-spin mt-2"></i></div>';

            const systemPrompt = `
                ã‚ãªãŸã¯ã€Œç½ªã‚’è£ãç¥ã€ã§ã™ã€‚
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‘Šç™½ã‚’èãã€ãã®ç½ªã®é‡ã•ã‚„å†…å®¹ã«å¿œã˜ã¦ã€Œèµ¦ã—ã€ã‹ã€Œç½°ã€ã‚’ä¸ãˆã¦ãã ã•ã„ã€‚
                ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§å›ç­”ã—ã¦ãã ã•ã„ã€‚
                
                SCORE: [æ•´æ•°å€¤ã€‚è‰¯ã„è¡Œã„ãªã‚‰+10ã€œ+100ã€æ‚ªã„è¡Œã„ãªã‚‰-10ã€œ-100ã€é¢ç™½ã„ãªã‚‰ãƒœãƒ¼ãƒŠã‚¹]
                VERDICT: [ã€Œç„¡ç½ªã€ã¾ãŸã¯ã€Œæœ‰ç½ªã€ãªã©çŸ­ã„åˆ¤å®š]
                COMMENT: [ç¥ã¨ã—ã¦ã®è¾›è¾£ã‹ã¤ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ãªã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ50æ–‡å­—ä»¥å†…ï¼‰]
            `;

            const prompt = `å‘Šç™½å†…å®¹: "${sin}"`;
            const rawResponse = await callGemini(prompt, systemPrompt);
            
            // Simple Parse logic
            let score = -10; // Default penalty
            let verdict = "æœ‰ç½ª";
            let comment = "è§£æä¸èƒ½ãªç½ªã˜ã‚ƒ...";
            
            try {
                const lines = rawResponse.split('\n');
                lines.forEach(line => {
                    if(line.includes('SCORE:')) score = parseInt(line.split(':')[1].trim());
                    if(line.includes('VERDICT:')) verdict = line.split(':')[1].trim();
                    if(line.includes('COMMENT:')) comment = line.split(':')[1].trim();
                });
            } catch(e) { console.error("Parse error", e); }

            state.karma += score;
            updateKarmaDisplay();

            const stampColor = score >= 0 ? 'text-green-500 border-green-500' : 'text-red-500 border-red-500';
            const scoreSign = score > 0 ? '+' : '';
            
            resultBox.innerHTML = `
                <div class="relative w-full text-center">
                    <div class="verdict-stamp ${stampColor} mb-4">${verdict}</div>
                    <p class="text-lg font-bold mb-2">${comment}</p>
                    <div class="text-sm text-gray-400">
                        å¾³ãƒã‚¤ãƒ³ãƒˆå¤‰å‹•: <span class="${score >= 0 ? 'text-green-400' : 'text-red-400'} font-bold text-xl">${scoreSign}${score}</span>
                    </div>
                </div>
            `;
            $('sin-input').value = '';
        }

        /* --- GENESIS FUNCTION --- */
        async function createGenesis() {
            const e1 = $('genesis-input-1').value.trim();
            const e2 = $('genesis-input-2').value.trim();
            if(!e1 || !e2) {
                alert("2ã¤ã®è¦ç´ ã‚’å…¥åŠ›ã›ã‚ˆã€‚ç„¡ã‹ã‚‰ã¯ä½•ã‚‚ç”Ÿã¾ã‚Œã‚“ãã€‚");
                return;
            }

            const resultBox = $('genesis-result');
            resultBox.classList.remove('hidden');
            resultBox.innerHTML = `
                <div class="text-center py-8">
                    <div class="inline-block animate-spin text-4xl mb-2">âœ¨</div>
                    <div class="text-glow-main font-bold">ä¸–ç•Œã‚’æ§‹ç¯‰ä¸­...</div>
                </div>`;

            const systemPrompt = `
                ã‚ãªãŸã¯ã€Œå¤©åœ°å‰µé€ ã®ç¥ã€ã§ã™ã€‚
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæç¤ºã—ãŸ2ã¤ã®è¦ç´ ã‚’ä½¿ã£ã¦ã€æ»‘ç¨½ã§å£®å¤§ãªã€Œå‰µä¸–è¨˜ï¼ˆä¸–ç•Œã®å§‹ã¾ã‚Šã®ç‰©èªï¼‰ã€ã‚’å³èˆˆã§ä½œã£ã¦ãã ã•ã„ã€‚
                
                ã‚¹ã‚¿ã‚¤ãƒ«ï¼š
                - è–æ›¸ã®ã‚ˆã†ãªè˜å³ãªå£èª¿ï¼ˆã€Œå…‰ã‚ã‚Œã¨è¨€ã£ãŸã€ãªã©ï¼‰
                - ã—ã‹ã—å†…å®¹ã¯ã‚·ãƒ¥ãƒ¼ãƒ«ã§é¢ç™½ã„
                - æŒ‡å®šã•ã‚ŒãŸ2ã¤ã®è¦ç´ ãŒã€ä¸–ç•Œã®å‰µé€ ã«ã©ã†é–¢ã‚ã£ãŸã‹ç„¡ç†ã‚„ã‚Šã“ã˜ã¤ã‘ã‚‹
                - 200æ–‡å­—ã€œ300æ–‡å­—ç¨‹åº¦
            `;

            const prompt = `è¦ç´ 1: ${e1}, è¦ç´ 2: ${e2}`;
            const aiResponse = await callGemini(prompt, systemPrompt);

            resultBox.innerHTML = `
                <h4 class="text-center text-sm text-gray-400 mb-4 border-b border-gray-700 pb-2">ã€ ${e1} ã¨ ${e2} ã®æ›¸ ã€ ç¬¬1ç« </h4>
                <div class="font-serif leading-relaxed text-lg text-justify">
                    ${aiResponse.replace(/\n/g, '<br>')}
                </div>
                <div class="text-center mt-6">
                    <i class="fas fa-book-open text-3xl opacity-50"></i>
                </div>
            `;
        }

        /* --- NAMING FUNCTION (NEW) --- */
        async function grantTitle() {
            const theme = $('naming-input').value.trim();
            const resultBox = $('naming-result');
            const titleEl = $('generated-title');
            const meaningEl = $('generated-meaning');
            
            resultBox.classList.remove('hidden');
            titleEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            meaningEl.innerText = 'ç¥è¨—ã‚’å—ä¿¡ä¸­...';

            const systemPrompt = `
                ã‚ãªãŸã¯ã€Œç•°åã‚’æˆã‘ã‚‹ç¥ã€ã§ã™ã€‚
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æœ›ï¼ˆãƒ†ãƒ¼ãƒï¼‰ã¾ãŸã¯ãƒ©ãƒ³ãƒ€ãƒ ãªç™ºæƒ³ã§ã€
                ã‚¢ãƒ‹ãƒ¡ã‚„ã‚²ãƒ¼ãƒ ã«å‡ºã¦ãã‚‹ã‚ˆã†ãªã€Œã‚«ãƒƒã‚³ã‚¤ã‚¤ãŒå°‘ã—ç—›ã„ï¼ˆä¸­äºŒç—…çš„ãªï¼‰äºŒã¤åã€ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
                
                å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
                TITLE: [äºŒã¤å]
                MEANING: [ãã®äºŒã¤åã®å£®å¤§ãªæ„å‘³ã‚„ç”±æ¥ï¼ˆ1è¡Œï¼‰]
            `;

            const prompt = theme ? `ãƒ†ãƒ¼ãƒ: ${theme}` : "ãƒ†ãƒ¼ãƒ: ãƒ©ãƒ³ãƒ€ãƒ ãªã‚«ãƒƒã‚³ã‚¤ã‚¤ã‚‚ã®";
            const rawResponse = await callGemini(prompt, systemPrompt);

            let title = "åç„¡ã—ã®æ¨©åŒ–";
            let meaning = "è§£æä¸èƒ½...";

            try {
                const lines = rawResponse.split('\n');
                lines.forEach(line => {
                    if(line.includes('TITLE:')) title = line.split(':')[1].trim();
                    if(line.includes('MEANING:')) meaning = line.split(':')[1].trim();
                });
            } catch(e) { console.error("Parse error", e); }

            // Update UI
            titleEl.innerText = title;
            titleEl.setAttribute('data-text', title); // Update glitch attr
            meaningEl.innerText = meaning;
        }

        function equipTitle() {
            const newTitle = $('generated-title').innerText;
            if(!newTitle || newTitle.includes('spinner')) return;

            $('user-name-input').value = newTitle;
            updateSettings();
            
            alert(`ç§°å·ã€Œ${newTitle}ã€ã‚’è£…å‚™ã—ãŸï¼`);
            $('naming-input').value = '';
        }

        /* --- BACKGROUND PARTICLES --- */
        const canvas = document.getElementById('universe');
        const ctx = canvas.getContext('2d');
        let width, height;
        const particles = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        class Star {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 2;
                this.speed = Math.random() * 0.5 + 0.1;
                this.opacity = Math.random();
            }
            update() {
                this.y -= this.speed;
                if (this.y < 0) this.reset();
                this.opacity = Math.sin(Date.now() * 0.001 * this.speed * 10) * 0.5 + 0.5;
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initStars() {
            for(let i=0; i<100; i++) particles.push(new Star());
        }
        function animateStars() {
            ctx.clearRect(0,0,width,height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateStars);
        }

        window.addEventListener('resize', resize);
        resize();
        initStars();
        animateStars();

        // Initial settings trigger to set colors
        setTheme(state.theme.main, state.theme.sub);

    </script>
</body>
</html>
